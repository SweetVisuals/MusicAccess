{"version":3,"file":"index.js","sources":["../../../src/extensions/search/invisibles.ts"],"sourcesContent":["import { BasicExtension } from \"../../index.js\"\nimport { createSearchAPI } from \"./search.js\"\n\n/**\n * Extension that shows tabs and spaces.\n * @param alwaysShow By default, spaces and tabs are only shown when they're selected.\n * By passing `true`, they're always shown, which negatively impacts performance when\n * typing, and increases the amount of elements in the DOM.\n *\n * Requires styling from `prism-code-editor/invisibles.css`.\n */\nconst showInvisibles = (alwaysShow?: boolean): BasicExtension => {\n\treturn editor => {\n\t\tlet prev: string\n\t\tconst searchAPI = createSearchAPI(editor)\n\t\tconst matches = searchAPI.matches\n\t\tconst container = searchAPI.container\n\t\tconst nodes = container.children\n\t\tconst tabs: boolean[] = []\n\t\tconst update = () => {\n\t\t\tconst value = editor.value\n\t\t\tconst [start, end] = editor.getSelection()\n\n\t\t\tif (!alwaysShow || prev != (prev = value)) {\n\t\t\t\tsearchAPI.search(\" |\\t\", true, false, true, alwaysShow ? undefined : [start, end])\n\t\t\t\tfor (let i = 0, l = matches.length; i < l; i++) {\n\t\t\t\t\tif ((value[matches[i][0]] == \"\\t\") == !tabs[i]) {\n\t\t\t\t\t\tnodes[i].className = (tabs[i] = !tabs[i]) ? \"pce-tab\" : \"\"\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tcontainer.className = \"pce-invisibles\"\n\t\tif (editor.value) update()\n\t\teditor.addListener(\"selectionChange\", update)\n\t}\n}\n\nexport { showInvisibles }\n"],"names":[],"mappings":";;;AAWM,MAAA,iBAAiB,CAAC,eAAyC;AAChE,SAAO,CAAU,WAAA;AACZ,QAAA;AACE,UAAA,YAAY,gBAAgB,MAAM;AACxC,UAAM,UAAU,UAAU;AAC1B,UAAM,YAAY,UAAU;AAC5B,UAAM,QAAQ,UAAU;AACxB,UAAM,OAAkB,CAAC;AACzB,UAAM,SAAS,MAAM;AACpB,YAAM,QAAQ,OAAO;AACrB,YAAM,CAAC,OAAO,GAAG,IAAI,OAAO,aAAa;AAEzC,UAAI,CAAC,cAAc,SAAS,OAAO,QAAQ;AAChC,kBAAA,OAAO,OAAQ,MAAM,OAAO,MAAM,aAAa,SAAY,CAAC,OAAO,GAAG,CAAC;AACjF,iBAAS,IAAI,GAAG,IAAI,QAAQ,QAAQ,IAAI,GAAG,KAAK;AAC1C,cAAA,MAAM,QAAQ,CAAC,EAAE,CAAC,CAAC,KAAK,OAAS,CAAC,KAAK,CAAC,GAAG;AACzC,kBAAA,CAAC,EAAE,aAAa,KAAK,CAAC,IAAI,CAAC,KAAK,CAAC,KAAK,YAAY;AAAA,UAAA;AAAA,QACzD;AAAA,MACD;AAAA,IAEF;AAEA,cAAU,YAAY;AAClB,QAAA,OAAO,MAAc,QAAA;AAClB,WAAA,YAAY,mBAAmB,MAAM;AAAA,EAC7C;AACD;"}