{"version":3,"file":"index.js","sources":["../../../src/extensions/autocomplete/tooltip.ts","../../../src/extensions/autocomplete/filter.ts"],"sourcesContent":["import { BasicExtension, InputSelection } from \"../../index.js\"\nimport { addTextareaListener, createTemplate, preventDefault } from \"../../core.js\"\nimport { addTooltip } from \"../../tooltips.js\"\nimport {\n\tgetLanguage,\n\tgetLineBefore,\n\tgetModifierCode,\n\tinsertText,\n\tprevSelection,\n} from \"../../utils/index.js\"\nimport { Cursor, cursorPosition } from \"../cursor.js\"\nimport { AutoCompleteConfig, Completion, CompletionContext, CompletionDefinition } from \"./types.js\"\nimport { searchTemplate } from \"../search/search.js\"\nimport { updateMatched, updateNode } from \"./utils.js\"\nimport { getStyleValue } from \"../../utils/local.js\"\n\nlet count = 0\n\nconst template = createTemplate(\"<div class=pce-ac-tooltip><ul role=listbox>\")\nconst rowTemplate = createTemplate(\n\t\"<li class=pce-ac-row role=option><div></div><div> </div><div class=pce-ac-details> \",\n)\n\nconst map: Record<string, CompletionDefinition<any>> = {}\n\n/**\n * Registers completion sources for a set of languages.\n * If any of the languages already have completion sources, they're overridden.\n * @param langs Array of languages you want the completions to apply for.\n * @param definition Defines the completion sources for the languages along with additional\n * properties on the context passed to the completion sources.\n */\nconst registerCompletions = <T extends object>(\n\tlangs: string[],\n\tdefinition: CompletionDefinition<T>,\n) => {\n\tlangs.forEach(lang => (map[lang] = definition))\n}\n\n/**\n * Extension adding basic autocomplete to an editor. For autocompletion to work, you need to\n * {@link registerCompletions} for specific languages.\n *\n * @param config Object used to configure the extension. The `filter` property is required.\n *\n * Requires the {@link cursorPosition} extension to work.\n *\n * Requires styling from `prism-code-editor/autocomplete.css`. Also requires a stylesheet\n * for icons. `prism-code-editor/autocomplete-icons.css` adds some icons from VSCode, but\n * you can define your own icons instead.\n *\n * @see {@link Completion.icon} for how to style your own icons.\n */\nconst autoComplete =\n\t(config: AutoCompleteConfig): BasicExtension =>\n\t(editor, options) => {\n\t\tlet isOpen: boolean\n\t\tlet shouldOpen: boolean\n\t\tlet currentOptions: [number, number[], number, number, Completion][]\n\t\tlet numOptions: number\n\t\tlet activeIndex: number\n\t\tlet active: HTMLLIElement | undefined\n\t\tlet pos: number\n\t\tlet offset: number\n\t\tlet rowHeight: number\n\t\tlet cursor: Cursor | undefined\n\t\tlet stops: null | number[]\n\t\tlet activeStop: number\n\t\tlet currentSelection: InputSelection\n\t\tlet prevLength: number\n\t\tlet isDeleteForwards: boolean\n\n\t\tconst windowSize = 13\n\t\tconst textarea = editor.textarea\n\t\tconst getSelection = editor.getSelection\n\t\tconst tooltip = template()\n\t\tconst tabStopsContainer = searchTemplate()\n\t\tconst [show, _hide] = addTooltip(editor, tooltip)\n\t\tconst list = tooltip.firstChild as HTMLUListElement\n\t\tconst id = (list.id = \"pce-ac-\" + count++)\n\t\tconst rows = list.children as HTMLCollectionOf<HTMLLIElement>\n\t\tconst add = editor.addListener\n\t\tconst prevIcons: string[] = []\n\t\tconst hide = () => {\n\t\t\tif (isOpen) {\n\t\t\t\t_hide()\n\t\t\t\ttextarea.removeAttribute(\"aria-haspopup\")\n\t\t\t\ttextarea.removeAttribute(\"aria-activedescendant\")\n\t\t\t\tisOpen = false\n\t\t\t}\n\t\t}\n\n\t\tconst setRowHeight = () => {\n\t\t\trowHeight = getStyleValue(rows[0], \"height\")\n\t\t}\n\n\t\tconst updateRow = (index: number) => {\n\t\t\tconst option = currentOptions[index + offset]\n\t\t\tconst [iconEl, labelEl, detailsEl] = rows[index].children as HTMLCollectionOf<HTMLDivElement>\n\t\t\tconst completion = option[4]\n\t\t\tconst icon = completion.icon || \"variable\"\n\n\t\t\tupdateMatched(labelEl, option[1], completion.label)\n\t\t\tupdateNode(detailsEl.firstChild as Text, completion.detail || \"\")\n\n\t\t\tif (prevIcons[index] != icon) {\n\t\t\t\ticonEl.className = `pce-ac-icon pce-ac-icon-${(prevIcons[index] = icon)}`\n\t\t\t\ticonEl.style.color = `var(--pce-ac-icon-${icon})`\n\t\t\t}\n\t\t}\n\n\t\tconst scrollActiveIntoView = () => {\n\t\t\tsetRowHeight()\n\t\t\tconst scrollTop = tooltip.scrollTop\n\t\t\tconst lower = rowHeight * activeIndex\n\t\t\tconst upper = rowHeight * (activeIndex + 1) - tooltip.clientHeight\n\n\t\t\ttooltip.scrollTop = scrollTop > lower ? lower : scrollTop < upper ? upper : scrollTop\n\t\t}\n\n\t\tconst updateActive = () => {\n\t\t\tconst newActive = rows[activeIndex - offset]\n\t\t\tif (newActive != active) {\n\t\t\t\tactive?.removeAttribute(\"aria-selected\")\n\t\t\t\tif (newActive) {\n\t\t\t\t\ttextarea.setAttribute(\"aria-activedescendant\", newActive.id)\n\t\t\t\t\tnewActive.setAttribute(\"aria-selected\", true as any)\n\t\t\t\t} else {\n\t\t\t\t\ttextarea.removeAttribute(\"aria-activedescendant\")\n\t\t\t\t}\n\t\t\t\tactive = newActive\n\t\t\t}\n\t\t}\n\n\t\tconst move = (decrement?: boolean) => {\n\t\t\tif (decrement) activeIndex = activeIndex ? activeIndex - 1 : numOptions - 1\n\t\t\telse activeIndex = activeIndex + 1 < numOptions ? activeIndex + 1 : 0\n\t\t\tscrollActiveIntoView()\n\t\t\tupdateActive()\n\t\t}\n\n\t\tconst insertOption = (index: number) => {\n\t\t\tif (options.readOnly) return\n\t\t\tlet [, , start, end, completion] = currentOptions[index]\n\t\t\tlet { label, tabStops: tabStops = [], insert } = completion\n\t\t\tlet l = tabStops.length\n\t\t\ttabStops = tabStops.map(stop => stop + start)\n\n\t\t\tif (insert) {\n\t\t\t\tlet indent = \"\\n\" + getLineBefore(editor.value, pos).match(/\\s*/)![0]\n\t\t\t\tlet tab = options.insertSpaces == false ? \"\\t\" : \" \".repeat(options.tabSize || 2)\n\t\t\t\tlet temp = tabStops.slice()\n\n\t\t\t\tinsert = insert.replace(/\\n|\\t/g, (match, index: number) => {\n\t\t\t\t\tlet replacement = match == \"\\t\" ? tab : indent\n\t\t\t\t\tlet diff = replacement.length - 1\n\t\t\t\t\tlet i = 0\n\t\t\t\t\twhile (i < l) {\n\t\t\t\t\t\tif (temp[i] > index + start) tabStops[i] += diff\n\t\t\t\t\t\ti++\n\t\t\t\t\t}\n\n\t\t\t\t\treturn replacement\n\t\t\t\t})\n\t\t\t} else insert = label\n\n\t\t\tif (l % 2) tabStops[l] = tabStops[l - 1]\n\n\t\t\tinsertText(editor, insert, start, end, tabStops[0], tabStops[1])\n\n\t\t\tif (l > 2) {\n\t\t\t\tstops = tabStops\n\t\t\t\tactiveStop = 0\n\t\t\t\tprevLength = editor.value.length\n\t\t\t\tupdateStops()\n\t\t\t\tcurrentSelection = getSelection()\n\t\t\t\tif (!tabStopsContainer.parentNode) editor.overlays.append(tabStopsContainer)\n\t\t\t}\n\t\t\tcursor!.scrollIntoView()\n\t\t}\n\n\t\tconst moveActiveStop = (offset: number) => {\n\t\t\tactiveStop += offset\n\t\t\teditor.setSelection(stops![activeStop], stops![activeStop + 1])\n\t\t\tcursor!.scrollIntoView()\n\t\t}\n\n\t\tconst clearStops = () => {\n\t\t\ttabStopsContainer.remove()\n\t\t\tstops = null\n\t\t}\n\n\t\tconst updateStops = () => {\n\t\t\tlet sorted: [number, number][] = []\n\t\t\tlet i = 0\n\t\t\tfor (; i < stops!.length; ) sorted[i / 2] = [stops![i++], stops![i++]]\n\t\t\tsorted.sort((a, b) => a[0] - b[0])\n\t\t\tupdateMatched(tabStopsContainer, sorted.flat(), editor.value)\n\t\t}\n\n\t\tconst startQuery = (explicit = false) => {\n\t\t\tconst [start, end, dir] = getSelection()\n\t\t\tconst language = getLanguage(editor, (pos = dir < \"f\" ? start : end))\n\t\t\tconst definition = map[language]\n\t\t\tif (definition && (explicit || start == end) && !options.readOnly) {\n\t\t\t\tconst value = editor.value\n\t\t\t\tconst lineBefore = getLineBefore(value, pos)\n\t\t\t\tconst before = value.slice(0, pos)\n\t\t\t\tconst context: CompletionContext = {\n\t\t\t\t\tbefore,\n\t\t\t\t\tlineBefore,\n\t\t\t\t\tlanguage,\n\t\t\t\t\texplicit,\n\t\t\t\t\tpos,\n\t\t\t\t}\n\t\t\t\tconst newContext = Object.assign(context, definition.context?.(context, editor))\n\t\t\t\tconst filter = config.filter\n\n\t\t\t\tcurrentOptions = []\n\t\t\t\tdefinition.sources.forEach(source => {\n\t\t\t\t\tconst result = source(newContext, editor)\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tconst from = result.from\n\t\t\t\t\t\tconst query = before.slice(from)\n\n\t\t\t\t\t\tresult.options.forEach(option => {\n\t\t\t\t\t\t\tconst filterResult = filter(query, option.label)\n\t\t\t\t\t\t\tif (filterResult) {\n\t\t\t\t\t\t\t\tfilterResult[0] += option.boost || 0\n\t\t\t\t\t\t\t\t// @ts-expect-error Allow mutation\n\t\t\t\t\t\t\t\tfilterResult.push(from, result.to ?? end, option)\n\t\t\t\t\t\t\t\t// @ts-expect-error Allow mutation\n\t\t\t\t\t\t\t\tcurrentOptions.push(filterResult)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t\tif (currentOptions[0]) {\n\t\t\t\t\tcurrentOptions.sort((a, b) => b[0] - a[0] || a[4].label.localeCompare(b[4].label))\n\t\t\t\t\tnumOptions = currentOptions.length\n\t\t\t\t\tactiveIndex = offset = 0\n\n\t\t\t\t\tfor (let i = 0, l = numOptions < windowSize ? numOptions : windowSize; i < l; ) {\n\t\t\t\t\t\tupdateRow(i++)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!isOpen) {\n\t\t\t\t\t\tconst { clientHeight, clientWidth } = editor.scrollContainer\n\t\t\t\t\t\tconst pos = cursor!.getPosition()\n\t\t\t\t\t\tconst max = Math.max(pos.bottom, pos.top)\n\t\t\t\t\t\ttooltip.style.width = `min(25em, ${clientWidth}px - var(--padding-left) - 1em)`\n\t\t\t\t\t\ttooltip.style.maxHeight = `min(17em, ${max}px + .25em, ${clientHeight}px - 2em)`\n\t\t\t\t\t}\n\n\t\t\t\t\tlist.style.paddingTop = \"\"\n\t\t\t\t\tlist.style.height = rowHeight ? rowHeight * numOptions + \"px\" : 1.4 * numOptions + \"em\"\n\t\t\t\t\ttooltip.scrollTop = 0\n\n\t\t\t\t\tisOpen = true\n\t\t\t\t\tshow(config.preferAbove)\n\t\t\t\t\ttextarea.setAttribute(\"aria-haspopup\", \"listbox\")\n\t\t\t\t\tupdateActive()\n\t\t\t\t} else hide()\n\t\t\t} else hide()\n\t\t}\n\n\t\tconst addSelectionHandler = () => {\n\t\t\tif (!cursor && (cursor = editor.extensions.cursor)) {\n\t\t\t\t// Must be added after the cursor's selectionChange handler\n\t\t\t\tadd(\"selectionChange\", selection => {\n\t\t\t\t\tif (stops && (selection[0] < stops[activeStop] || selection[1] > stops[activeStop + 1])) {\n\t\t\t\t\t\tclearStops()\n\t\t\t\t\t}\n\t\t\t\t\tif (shouldOpen) {\n\t\t\t\t\t\tshouldOpen = false\n\t\t\t\t\t\tstartQuery()\n\t\t\t\t\t} else hide()\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\ttabStopsContainer.className = \"pce-tabstops\"\n\t\ttextarea.setAttribute(\"aria-controls\", id)\n\t\ttextarea.setAttribute(\"aria-autocomplete\", \"list\")\n\n\t\tfor (let i = 0; i < windowSize; ) {\n\t\t\tlist.append(rowTemplate())\n\t\t\trows[i].id = id + \"-\" + i++\n\t\t}\n\n\t\ttooltip.onscroll = () => {\n\t\t\tsetRowHeight()\n\t\t\tconst newOffset = Math.min(Math.floor(tooltip.scrollTop / rowHeight), numOptions - windowSize)\n\t\t\tif (newOffset == offset || newOffset < 0) return\n\n\t\t\toffset = newOffset\n\t\t\tfor (let i = 0; i < windowSize; i) {\n\t\t\t\tupdateRow(i++)\n\t\t\t}\n\n\t\t\tlist.style.paddingTop = offset * rowHeight + \"px\"\n\t\t\tupdateActive()\n\t\t}\n\n\t\tadd(\"update\", () => {\n\t\t\taddSelectionHandler()\n\n\t\t\tif (stops) {\n\t\t\t\tlet value = editor.value\n\t\t\t\tlet diff = prevLength - (prevLength = value.length)\n\t\t\t\tlet [start, end] = currentSelection\n\t\t\t\tlet i = 0\n\t\t\t\tlet l = stops.length\n\t\t\t\tlet activeStart = stops[activeStop]\n\t\t\t\tlet activeEnd = stops[activeStop + 1]\n\n\t\t\t\tif (start < stops[activeStop] || end > activeEnd) {\n\t\t\t\t\tclearStops()\n\t\t\t\t} else {\n\t\t\t\t\tif (isDeleteForwards) end++\n\t\t\t\t\tif (end <= activeEnd) stops[activeStop + 1] -= diff\n\t\t\t\t\tif (end <= activeStart && diff > 0) stops[activeStop] -= diff\n\t\t\t\t\tfor (; i < l; i += 2) {\n\t\t\t\t\t\tif (i != activeStop && stops[i] >= activeEnd) {\n\t\t\t\t\t\t\tstops[i] = Math.max(stops[i] - diff, stops[activeStop + 1])\n\t\t\t\t\t\t\tstops[i + 1] = Math.max(stops[i + 1] - diff, stops[activeStop + 1])\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tupdateStops()\n\t\t\t\t}\n\t\t\t\tisDeleteForwards = false\n\t\t\t\tcurrentSelection = getSelection()\n\t\t\t}\n\t\t})\n\t\taddTextareaListener(editor, \"mousedown\", () => {\n\t\t\tif (stops) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t// Timeout runs before selectionChange, but after\n\t\t\t\t\t// the selection changes as a result of the click\n\t\t\t\t\tconst [start, end] = getSelection()\n\t\t\t\t\tif (stops && (start < stops[activeStop] || end > stops[activeStop + 1])) {\n\t\t\t\t\t\tfor (let i = 0, l = stops.length; i < stops.length; i += 2) {\n\t\t\t\t\t\t\tif (start >= stops[i] && end <= stops[i + 1]) {\n\t\t\t\t\t\t\t\tif (i + 3 > l) clearStops()\n\t\t\t\t\t\t\t\telse activeStop = i\n\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t}\n\t\t})\n\t\taddTextareaListener(\n\t\t\teditor,\n\t\t\t\"beforeinput\",\n\t\t\te => {\n\t\t\t\tlet inputType = e.inputType\n\t\t\t\tlet isDelete = inputType[0] == \"d\"\n\t\t\t\tlet isInsert = inputType == \"insertText\"\n\t\t\t\tlet data = e.data\n\t\t\t\tif (\n\t\t\t\t\tisOpen &&\n\t\t\t\t\tisInsert &&\n\t\t\t\t\t!prevSelection &&\n\t\t\t\t\tdata &&\n\t\t\t\t\t!data[1] &&\n\t\t\t\t\tcurrentOptions[activeIndex][4].commitChars?.includes(data)\n\t\t\t\t) {\n\t\t\t\t\tinsertOption(activeIndex)\n\t\t\t\t}\n\n\t\t\t\tif (stops) {\n\t\t\t\t\tcurrentSelection = getSelection()\n\t\t\t\t\tisDeleteForwards =\n\t\t\t\t\t\tisDelete && inputType[13] == \"F\" && currentSelection[0] == currentSelection[1]\n\t\t\t\t}\n\t\t\t\tshouldOpen =\n\t\t\t\t\t!config.explicitOnly &&\n\t\t\t\t\t(shouldOpen || (isInsert && !prevSelection) || (isDelete && isOpen))\n\t\t\t},\n\t\t\ttrue,\n\t\t)\n\t\taddTextareaListener(editor, \"blur\", e => {\n\t\t\tif (config.closeOnBlur != false && !tooltip.contains(e.relatedTarget as Element)) hide()\n\t\t})\n\t\taddTextareaListener(\n\t\t\teditor,\n\t\t\t\"keydown\",\n\t\t\te => {\n\t\t\t\tconst key = e.key\n\t\t\t\tconst code = getModifierCode(e)\n\n\t\t\t\tif (key == \" \" && code == 2) {\n\t\t\t\t\taddSelectionHandler()\n\t\t\t\t\tif (cursor) startQuery(true)\n\t\t\t\t\tpreventDefault(e)\n\t\t\t\t} else if (!code && isOpen) {\n\t\t\t\t\tif (/^Arrow[UD]/.test(key)) {\n\t\t\t\t\t\tmove(key[5] == \"U\")\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t} else if (/Tab|Enter/.test(key)) {\n\t\t\t\t\t\tinsertOption(activeIndex)\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t} else if (key == \"Escape\") {\n\t\t\t\t\t\thide()\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t} else if (key.slice(0, 4) == \"Page\") {\n\t\t\t\t\t\tsetRowHeight()\n\t\t\t\t\t\tlet top = tooltip.scrollTop\n\t\t\t\t\t\tlet height = tooltip.clientHeight\n\t\t\t\t\t\tlet newActive: number\n\t\t\t\t\t\tif (key[4] == \"U\") {\n\t\t\t\t\t\t\tnewActive = Math.ceil(top / rowHeight)\n\t\t\t\t\t\t\tactiveIndex =\n\t\t\t\t\t\t\t\tactiveIndex == newActive || newActive - 1 == activeIndex\n\t\t\t\t\t\t\t\t\t? Math.ceil(Math.max(0, (top - height) / rowHeight + 1))\n\t\t\t\t\t\t\t\t\t: newActive\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\ttop += height + 1\n\t\t\t\t\t\t\tnewActive = Math.ceil(top / rowHeight - 2)\n\t\t\t\t\t\t\tactiveIndex =\n\t\t\t\t\t\t\t\tactiveIndex == newActive || newActive + 1 == activeIndex\n\t\t\t\t\t\t\t\t\t? Math.ceil(Math.min(numOptions - 1, (top + height) / rowHeight - 3))\n\t\t\t\t\t\t\t\t\t: newActive\n\t\t\t\t\t\t}\n\t\t\t\t\t\tscrollActiveIntoView()\n\t\t\t\t\t\tupdateActive()\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t}\n\t\t\t\t} else if ((code & 7) == 0 && !isOpen && key == \"Tab\" && stops) {\n\t\t\t\t\tif (!code) {\n\t\t\t\t\t\tmoveActiveStop(2)\n\t\t\t\t\t\tif (activeStop + 3 > stops.length) clearStops()\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t} else if (activeStop) {\n\t\t\t\t\t\tmoveActiveStop(-2)\n\t\t\t\t\t\tpreventDefault(e)\n\t\t\t\t\t}\n\t\t\t\t} else if (!isOpen && !code && key == \"Escape\") {\n\t\t\t\t\tclearStops()\n\t\t\t\t\tpreventDefault(e)\n\t\t\t\t}\n\t\t\t},\n\t\t\ttrue,\n\t\t)\n\n\t\tlist.onmousedown = e => {\n\t\t\tinsertOption([].indexOf.call(rows, (e.target as HTMLElement).closest(\"li\") as never) + offset)\n\t\t\tpreventDefault(e)\n\t\t}\n\n\t\ttooltip.addEventListener(\"focusout\", e => {\n\t\t\tif (config.closeOnBlur != false && e.relatedTarget != textarea) hide()\n\t\t})\n\t}\n\nexport { autoComplete, registerCompletions }\n","import { CompletionFilter } from \"./types\"\n\n/**\n * Fuzzy filter that only requires that the option includes all the characters in the\n * query string in order with any number of character between each.\n *\n * Occurrences that result in score penalties:\n * - Skipping characters in the option.\n * - The case of the characters doesn't match.\n * - The match doesn't start at the beginning.\n * - The option is longer than the query.\n */\nconst fuzzyFilter: CompletionFilter = (query: string, option: string) => {\n\tconst optionLen = option.length\n\tconst queryLen = query.length\n\n\tif (queryLen > optionLen) return\n\tif (queryLen == 1 || queryLen == optionLen) return strictFilter(query, option)\n\n\tconst queryLc = query.toLowerCase()\n\tconst optionLc = option.toLowerCase()\n\tconst matched: number[] = []\n\tconst fullMatch = optionLc.indexOf(queryLc)\n\n\tlet score = 0\n\tlet i = 0\n\tlet prevPos = 0\n\tlet j = 0\n\tfor (; i < queryLen; i++) {\n\t\tconst char = queryLc[i]\n\t\tconst pos = fullMatch > -1 ? i + fullMatch : optionLc.indexOf(char, prevPos)\n\t\tconst hasSkipped = pos > prevPos\n\n\t\tif (pos < 0) return\n\t\tif (hasSkipped) score -= 800\n\t\tif (hasSkipped || !j) {\n\t\t\tmatched[j++] = pos\n\t\t\tmatched[j++] = pos + 1\n\t\t} else {\n\t\t\tmatched[j - 1] = pos + 1\n\t\t}\n\n\t\t// Add a penalty if the query and option had different case\n\t\tif ((<any>(char != query[i])) ^ (<any>(optionLc[pos] != option[pos]))) score -= 100\n\t\tprevPos = pos + 1\n\t}\n\n\treturn [score - optionLen - (queryLen < optionLen ? 100 : 0), matched]\n}\n\n/**\n * Strict filter that requires the option to start with the query string.\n *\n * Occurrences that result in score penalties:\n * - The case of the query and the start of the option is different.\n * - The option is longer than the query.\n */\nconst strictFilter: CompletionFilter = (query: string, option: string) => {\n\tconst optionLen = option.length\n\tconst queryLen = query.length\n\n\tif (queryLen > optionLen) return\n\n\tconst start = option.slice(0, queryLen)\n\tconst score = start == query ? 0 : query.toLowerCase() == start.toLowerCase() ? -200 : null\n\tif (score == null) return\n\n\treturn [query ? score - optionLen - (queryLen < optionLen ? 100 : 0) : 0, [0, queryLen]]\n}\n\nexport { fuzzyFilter, strictFilter }\n"],"names":["index","offset","pos"],"mappings":"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"}